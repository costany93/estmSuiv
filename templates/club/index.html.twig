{% extends 'base.html.twig' %}

{% block title %}Clubs - ESTM{% endblock %}

{% block body %}
    {% set user = app.user %}

    <div class="container">
        <div class="row mt-5">
        {% for club in clubs %}
                <div class="col-md-4 mt-2">
                    <div class="card" style="width: 18rem;">
                        <img src="{{asset('build/images/logo.png')}}" class="card-img-top" alt="club {{club.nom}}">
                        <div class="card-body">
                            <h5 class="card-title text-center">Club {{club.nom}}</h5>
                            <p class="card-text text-center">{{club.description|slice(0,100)}}...</p>
                            <div class="row">
                                <div class="col">
                                    {#On check si utilisateur connecté est un étudiant#}
                                    {% if app.user.etudiant %}
                                        {#si oui on check si il appartient déja à un club#}
                                        {% set etudiant = app.user.etudiant %}
                                        {% if etudiant.club is not null %}
                                            {% if etudiant.club.nom == club.nom %}
                                                <a href="{{path('club_show',{slug: club.slug})}}" class="btn-success btn btn-block">
                                                        <i class="far fa-thumbs-up"></i>
                                                        Accéder au club
                                                    </a>
                                                    {% if etudiant.membership is null %}
                                                        <a href="{{path('adhesion_quit',{slug: club.slug})}}" class="btn-danger btn btn-block">
                                                                <i class="fas fa-arrow-circle-left"></i>
                                                                Quittez le club
                                                        </a>
                                                    {% else %}
                                                        <Button type="button" class="btn-primary btn btn-block">
                                                                <i class="fas fa-arrow-circle-left"></i>
                                                                Demande de sorti en cours de traitement
                                                        </Button>
                                                    {% endif %}
                                                    
                                            {% else %}
                                                <button type="button" class="btn-danger btn btn-block">
                                                        <i class="fas fa-user-lock"></i>
                                                        Pas membre
                                                    </button>
                                            {% endif %}
                                        {#si non on lui laisse la possibilité d'adhérer à un club#}
                                        {% else %}

                                            {#Si il n'a pas encore fais une demande d'adhesion on lui laisse la possibilité de faire une demande#}
                                            {% if etudiant.membership is null %}
                                                <a href="{{path('adhesion_new',{slug: club.slug})}}" class="btn-success btn btn-block">
                                                    <i class="far fa-thumbs-up"></i>
                                                    Adhérer au club
                                                </a>
                                            {% else %}
                                            {#Si non #}
                                                {% if etudiant.membership.club.nom == club.nom %}
                                                    <Button type="button" class="btn-success btn btn-block">
                                                    <i class="far fa-thumbs-up"></i>
                                                    Demande en cours de traitement
                                                </Button>
                                                {% else %}
                                                    <Button type="button" class="btn-danger btn btn-block">
                                                    <i class="fas fa-user-lock"></i>
                                                    Déjà une demande
                                                </Button>
                                                {% endif %}
                                                

                                            {% endif %}
                                            
                                        {% endif %}
                                    {# si ce n'est pas un étudiant on lui donne la possibilité de voir les informations du club#}
                                    {% else %}
                                        <a href="{{path('club_show',{slug: club.slug})}}" class="btn-primary btn btn-block">
                                            <i class="far fa-thumbs-up"></i>
                                            Informations du club
                                        </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        {% endfor %}
        </div>
    </div>
{% endblock %}
